name: iOS Build & Export IPA

on:
  push:
    branches:
      - main  # Ch·∫°y khi c√≥ push v√†o nh√°nh main

jobs:
  build:
    runs-on: macos-latest

    steps:
      - name: üì• Checkout code
        uses: actions/checkout@v4

      - name: üîß Set up Xcode
        run: sudo xcode-select -switch /Applications/Xcode.app

      - name: üîç Show available Xcode versions
        run: ls /Applications | grep Xcode

      - name: üìå Install dependencies (n·∫øu c√≥ SPM)
        run: xcodebuild -resolvePackageDependencies

      - name: üèóÔ∏è Build & Archive app
        run: |
          xcodebuild -project SwipeIt.xcodeproj \
                     -scheme SwipeIt \
                     -sdk iphoneos \
                     -configuration Release \
                     -archivePath build/SwipeIt.xcarchive archive

      # 5. Xu·∫•t file IPA
      - name: Export IPA
        run: |
          cd swipe-it-swift
          xcodebuild -exportArchive \
            -archivePath output/SwipeIt.xcarchive \
            -exportPath output/ \
            -exportOptionsPlist ExportOptions.plist

      # 6. Upload file IPA v√†o Artifact (T·∫£i xu·ªëng t·ª´ GitHub Action)
      - name: Upload IPA Artifact
        uses: actions/upload-artifact@v4
        with:
          name: SwipeIt.ipa
          path: swipe-it-swift/output/*.ipa
